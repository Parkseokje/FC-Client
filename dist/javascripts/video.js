"use strict";requirejs(["common","Vimeo","easyTimer","jqueryTimer"],function(o,n,e){function t(){m=new n("videoplayer",{loop:!1}),m.setVolume(.5),m.ready().then(function(){console.info("Player is ready."),m.getDuration().then(function(o){T=o,i()}).catch(function(o){console.error(o)}),O<T-5&&window.confirm("마지막 재생시점으로 이동하시겠습니까?")&&m.setCurrentTime(O).then(function(o){m.pause()}).catch(function(o){console.error(o)})}).catch(function(o){console.error(o)})}function i(){T?(v=g.timer(1e3*_,c,!0),v.stop(),s()):console.error("재생시간을 확인할 수 없습니다.")}function s(){r(V)}function r(o){Math.floor(T*(w/100))<=o&&(C.removeClass("blind"),S.addClass("blind"))}function c(){console.log("logging..."),y+=_,m.getCurrentTime().then(function(o){if(p>0&&p===o)return void m.pause().then(function(){console.log("비디오가 중지되었습니다."),S.removeClass("blind")}).catch(function(o){console.error(o)});p=o,g.ajax({type:"POST",url:"/video/log/playtime",data:{training_user_id:D,video_id:P,played_seconds:y,video_duration:T,currenttime:o}}).done(function(o){o.success?(y=0,V=o.total_played_seconds,r(V)):(console.error(o.msg),m.pause().then(function(){}).catch(function(o){console.error(o)}))})}).catch(function(o){console.error(o)})}function a(){console.log("video log end"),g.ajax({type:"POST",url:"/video/log/endtime",data:{video_id:P}}).done(function(o){o.success||console.error(o.msg)})}function l(){console.log("session log start"),g.ajax({type:"POST",url:"/session/log/starttime",data:{training_user_id:D,course_id:E,course_list_id:k}}).done(function(o){o.success?x=o.hasEnded:(console.error(o.msg),v.stop(),m.stop())})}function u(){console.log("session log end"),g.ajax({type:"POST",url:"/session/log/endtime",data:{training_user_id:D,course_id:E,course_list_id:k}}).done(function(o){o.success?window.location.href=j:(console.error(o.msg),v.stop(),m.stop())})}function d(){return axios.delete("/video/log",{params:{video_id:P}}).then(function(o){}).catch(function(o){console.error(o)})}function f(){return axios.delete("/session/log",{params:{training_user_id:D,course_list_id:k}}).then(function(o){}).catch(function(o){console.error(o)})}var p,g=g||window.$,m=null,h=g(".videoplayer"),_=h.data("interval"),v=null,y=0,w=(h.data("wait-seconds"),h.data("passive-rate")),T=null,b=g("#countdown .values"),x=!1,C=g("#btn_play_next"),j=C.parent().attr("href"),S=g("#btn_replay_video"),P=h.data("id"),V=h.data("total-play"),O=h.data("current-time"),D=C.data("training-user-id"),E=C.data("course-id"),k=C.data("course-list-id"),q=new e;g(function(){t()}),C.on("click",function(o){o.preventDefault(),q.stop(),u()}),m.on("play",function(o){l(),v.reset(1e3*_)}),m.on("error",function(o){console.info("error!"),console.error(o)}),m.on("pause",function(o){console.info("player: pause"),v.pause(),a()}),m.on("ended",function(o){console.info("player: ended"),v.pause(),r(V+_),a(),x||setTimeout(function(){g(".timer").removeClass("blind"),console.log("second timer started"),q.start({countdown:!0,startValues:{seconds:30}}),b.html(q.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요."),q.addEventListener("secondsUpdated",function(o){b.html(q.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요.")}),q.addEventListener("targetAchieved",function(o){b.html("학습 초기화 중입니다.."),setTimeout(function(){window.alert("30초 동안 다음 버튼을 누르지 않아 학습을 초기화 하였습니다.\n\n재시청 해주시기 바랍니다."),axios.all([d(),f()]).then(axios.spread(function(o,n){window.location.reload()}))},3e3)})},1e3)}),S.on("click",function(o){o.preventDefault(),m.unload().then(function(){S.addClass("blind")}).catch(function(o){console.log(o)})})});
//# sourceMappingURL=../maps/video.js.map
