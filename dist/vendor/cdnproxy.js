function setSecurePage(e){proxy_state_host=1==e?"https://cdnplayer.cdnetworks.com:8285":"http://cdnplayer.cdnetworks.com:8284"}function setNPlayer(e){newinPlayer=e}function setPlayerStart(e){videoStartFlag=e}function setMediaInfo(e,t){media_auth=t,mdia_url=encodeURIComponent(e)}function setdupcallback(e){dupProxycallback=e}function setduplicatePlayCallback(e){dupPlayercallback=e}function getMediaURL(e){return 1==e?proxy_https_host+"/cddr_streaming?url="+mdia_url+"&param="+media_auth:proxy_http_host+"/cddr_streaming?url="+mdia_url+"&param="+media_auth}function exitFunction(){console.log("exitFunction fire"),authdelete()}function setpageunloaccallback(){var e=get_browser();"IE"===e.name||"msie"===e.name||"safari"===e.name||"chrome"===e.name||"trident"===e.name?document.addEventListener?(document.addEventListener("pagehide",exitFunction,!1),document.addEventListener("unload",exitFunction,!1)):window.attachEvent&&(document.attachEvent("pagehide",exitFunction),document.attachEvent("unload",exitFunction)):"firefox"===e.name&&window.addEventListener("beforeunload",function(e){console.log("Player 종료합니다.");return authdelete(),e.defaultPrevenred=!0,"Player 종료합니다."})}function getNewinPlayerDuration(){var e=newinPlayer.getDuration();return parseInt(1e3*e)}function getNewinPlaybackRate(){var e=newinPlayer.getCurrentPlaybackRate();return parseInt(1e3*e)}function getNewinCurrentPosition(){var e=newinPlayer.getCurrentPlaybackTime();return parseInt(1e3*e)}function createXMLHttpRequest(){return new XMLHttpRequest}function starthtml5State(){switch(newinPlayer.getOpenState()){case NPlayer.OpenState.Opened:statehttp=createXMLHttpRequest();var e=proxy_state_host+"/mediastate?mediaKey="+media_auth+"&current="+getNewinCurrentPosition();e+="&playbackrate="+getNewinPlaybackRate()+"&duration="+getNewinPlayerDuration()+"&playstate="+newinPlayer.getPlayState()+"&openstate="+newinPlayer.getOpenState(),statehttp.onreadystatechange=html5statecallback,statehttp.open("GET",e,!0),statehttp.send(null)}}function html5statecallback(){if(4==statehttp.readyState)if(200==statehttp.status){var e=newinPlayer.getOpenState();e==NPlayer.OpenState.Opened&&1==videoStartFlag&&setTimeout("starthtml5State()",2e3)}else if(statehttp.status==PROXY_ERROR_FORCE_STOP){var t=NPLAYER_PLAYER_STOP_REQUEST_MSG;newinPlayer.stop(),newinPlayer.close(),setTimeout(function(){alert(t),"function"==typeof proxy_duprequest_callback&&proxy_duprequest_callback()},200)}else if(statehttp.status==PROXY_ERROR_DUP_CHECKED)if("function"==dupProxycallback)dupProxycallback();else{var t=NPLAYER_DUP_MSG;newinPlayer.stop(),newinPlayer.close(),setTimeout(function(){alert(t),"function"==typeof proxy_dupplayer_callback&&proxy_dupplayer_callback()},200)}else if(statehttp.status==PROXY_ERROR_CAPTURE_ENABLED){var t=STR_PROXY_ERROR_CAPTURE_ENABLED;newinPlayer.stop(),newinPlayer.close(),setTimeout(function(){alert(t),"function"==typeof proxy_guard_callback&&proxy_guard_callback()},200)}else{console.log("html5statecallback readyState=="+statehttp.readyState),console.log("html5statecallback status=="+statehttp.status);var e=newinPlayer.getOpenState();e==NPlayer.OpenState.Opened&&1==videoStartFlag&&setTimeout("starthtml5State()",2e3)}}function Stophtml5State(e){stopstatehttp=createXMLHttpRequest();var t=proxy_state_host+"/mediastate?mediaKey="+media_auth+"&openstate="+e;stopstatehttp.open("GET",t,!0),stopstatehttp.send(null)}function authdelete(){stopstatehttp=createXMLHttpRequest();var e=proxy_state_host+"/delgenauth?mediaKey="+media_auth;stopstatehttp.open("GET",e,!0),stopstatehttp.send(null)}function get_browser(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],{name:"IE",version:e[1]||""}):"Chrome"===o[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?{name:"Opera",version:e[1]}:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),o[0]=o[0].toLowerCase(),{name:o[0],version:o[1]})}function callErrorState(){callerrorhttp=createXMLHttpRequest();var e=proxy_state_host+"/errstate";callerrorhttp.onreadystatechange=callErrorStateresponse,callerrorhttp.open("GET",e,!0),callerrorhttp.send(null)}function callErrorStateresponse(){if(4==callerrorhttp.readyState)switch(console.log(callerrorhttp.responseText+"==code==="+callerrorhttp.status),callerrorhttp.status){case PROXY_ERROR_UNKONWN:onErrorMessage(STR_PROXY_ERROR_UNKONWN);break;case PROXY_ERROR_ACTIVE_NOT_CLEARED:onErrorMessage(STR_PROXY_ERROR_ACTIVE_NOT_CLEARED);break;case PROXY_ERROR_AUTH_NOT_FOUND:onErrorMessage(STR_PPROXY_ERROR_AUTH_NOT_FOUND);break;case PROXY_ERROR_AUTH_HTTP_403:onErrorMessage(STR_PPROXY_ERROR_AUTH_HTTP_403);break;case PROXY_ERROR_AUTH_HTTP_404:onErrorMessage(STR_PPROXY_ERROR_AUTH_HTTP_404);break;case PROXY_ERROR_BLOCKED_HTTP:onErrorMessage(STR_PPROXY_ERROR_BLOCKED_HTTP)}}function getSysinfo(e){sysinfohttp=createXMLHttpRequest();var t=proxy_state_host+"/sysinfo";systemresultcallback=e,sysinfohttp.onreadystatechange=SysinfoStateresponse,sysinfohttp.open("GET",t,!0),sysinfohttp.send(null)}function SysinfoStateresponse(){if(4==sysinfohttp.readyState){var e=JSON.parse(sysinfohttp.responseText);"function"==typeof systemresultcallback&&systemresultcallback(e)}}function onErrorMessage(e){$("#video-nplayer-1-msg tr td").text(e)}function checkNRunProxyAgent(e,t){console.log("checkNRunProxyAgent"),AgentCheckCallback=e,portcheckhandler=function(){ProxyPortCheck()},timeouthandler=function(){window.clearInterval(gtimer),ProxyPortCheckFail()},gtimer=window.setInterval(portcheckhandler,1e3),proxycheckTimer=window.setTimeout(timeouthandler,t)}function checkNRunProxyAgentOnce(e,t){AgentCheckCallback=e,portcheckhandler=function(){ProxyPortCheck()},timeouthandler=function(){window.clearInterval(gtimer),ProxyPortCheckFail()},portcheckhandler(),proxycheckTimer=window.setTimeout(timeouthandler,t)}function ProxyPortCheck(){proxyHealthhttp=createXMLHttpRequest(),proxyHealthchecked=!1;var e=proxy_state_host+"/portcheck";proxyHealthhttp.onreadystatechange=ProxyPortCheckHandler,proxyHealthhttp.open("GET",e,!0),proxyHealthhttp.send(null)}function ProxyPortCheckHandler(){4==proxyHealthhttp.readyState&&200==proxyHealthhttp.status&&(proxyHealthchecked=!0,window.clearInterval(gtimer),window.clearTimeout(gtimeout),window.removeEventListener("blur",eventhandler,!1),"function"==typeof AgentCheckCallback&&AgentCheckCallback(!0))}function ProxyPortCheckFail(){0==proxyHealthchecked&&"function"==typeof AgentCheckCallback&&AgentCheckCallback(!1)}function ExitProxyServer(){exithttp=createXMLHttpRequest();var e=proxy_state_host+"/exit";exithttp.open("GET",e,!0),exithttp.send(null)}function versionCheck(e){checkversioncallback=e,isMac?window.setTimeout("getProxyVer();",1e3):getProxyVer()}function compareversion(e,t){if(console.log(e),console.log(t),e===t)return 0;for(var o=e.split(","),n=t.split(","),a=Math.min(o.length,n.length),r=0;r<a;r++){if(parseInt(o[r])>parseInt(n[r]))return 1;if(parseInt(o[r])<parseInt(n[r]))return-1}return o.length>n.length?1:o.length<n.length?-1:0}function getProxyVer(){proxyverhttp=createXMLHttpRequest();var e=proxy_state_host+"/version";proxyverhttp.open("GET",e,!0),proxyverhttp.send(null),proxyverhttp.onreadystatechange=function(){4==proxyverhttp.readyState&&(console.log(proxyverhttp.responseText+" code __ "+proxyverhttp.status),200==proxyverhttp.status?compareversion(proxy_ver,proxyverhttp.responseText)>0?"function"==typeof checkversioncallback&&checkversioncallback(!0):"function"==typeof checkversioncallback&&checkversioncallback(!1):indicateRunFail())}}function launchProxy(e,t,o,n){function a(e){"function"==typeof e&&e()}function r(e){var t;return e||(e=document.body),t=document.createElement("iframe"),t.style.display="none",t.id="hiddenIframe",t.src="about:blank",e.appendChild(t),t}function l(e){console.log("launchProxy - AgentCheckCallback called"),1==e?(console.log("launchProxy - AgentCheckCallback success"),a(t)):(console.log("launchProxy - AgentCheckCallback fail"),!p.isChrome||isMac||h?(console.log("launchProxy - browser=chrome "+p.isChrome),console.log("launchProxy - browser!=Mac "+!isMac),console.log("launchProxy - browser!=notblur "+!h),a(o)):(console.log("browser.isChrome && !isMac && !notblur"),console.log("launchProxy - browser=chrome "+p.isChrome),console.log("launchProxy - browser!=Mac "+!isMac),console.log("launchProxy - browser!=notblur "+!h),a(indicateRunFail)))}var c,s,i,u,d,p,h=!0;if(console.log("launchProxy - test_1"),console.log("launchProxy - test_2"),console.log("launchProxy - test_3"),console.log("launchProxy - test_4"),p={isChrome:!1,isFirefox:!1,isIE:!1,isSafari:!1,isEdge:!1},console.log("launchProxy - test_5"),console.log("agent"+navigator.userAgent),navigator.userAgent.match(/Edge\//)?(p.isEdge=!0,console.log("Edge")):window.chrome&&!navigator.userAgent.match(/Opera|OPR\//)?(p.isChrome=!0,console.log("Chrome")):"undefined"!=typeof InstallTrigger?(p.isFirefox=!0,console.log("Firefox")):"ActiveXObject"in window?(p.isIE=!0,console.log("IE")):navigator.userAgent.match(/Safari\//)?(p.isSafari=!0,console.log("Safa")):console.log("agent"+navigator.userAgent),console.log("launchProxy - test_6"),p.isChrome&&!isMac||p.isEdge)i=function(){h=!1,window.clearTimeout(u),window.clearInterval(gtimer),window.clearTimeout(gtimeout),window.removeEventListener("blur",i,!1),console.log("test1 blurHandler"),p.isEdge?a(o):checkNRunProxyAgent(l,8e3)},d=function(){window.clearTimeout(gtimeout),window.removeEventListener("blur",i,!1),checkNRunProxyAgent(l,3e3),console.log("test1 timeoutHandler")},eventhandler=i,window.addEventListener("blur",i,!1),window.location.href=e,u=window.setTimeout(d,2e3),console.log("launchProxy - test_7");else if(navigator.msLaunchUri)console.log("navigator.msLaunchUri !! "+e),navigator.msLaunchUri(e,t,o),console.log("test_8");else if(p.isFirefox){s=r();try{s.contentWindow.location.href=e,checkNRunProxyAgent(l,8e3)}catch(e){"NS_ERROR_UNKNOWN_PROTOCOL"===e.name?(console.log("test3_firefox"),a(o)):(console.log("test4_firefox"),a(n))}finally{!function(e){s&&(e||(e=document.body),e.removeChild(s),s=null)}()}console.log("test_9")}else if(p.isIE){console.log("test_isIE_jungbae"),c=window.open("","launcher","width=0,height=0"),c.location.href=e;try{c.location.href="about:blank",checkNRunProxyAgent(l,8e3);var y=window.setInterval(function(){console.log("test4_____"),c.close(),c.closed&&window.clearInterval(y)},500)}catch(e){c=window.open("about:blank","launcher"),c.close(),console.log("test4___________"),a(o)}console.log("test_10")}else s=r(),s.contentWindow.location.href=e,d=function(){window.clearTimeout(u),checkNRunProxyAgent(l,4e3),console.log("test1")},u=window.setTimeout(d,2e3),console.log("test_11")}function mygentAuthCall(e,t){playruncallback=e,gentAuthhttp=createXMLHttpRequest();var o=proxy_state_host+"/genauth?genparam="+t;gentAuthhttp.onreadystatechange=mygentAuthCallHandler,gentAuthhttp.open("GET",o,!0),gentAuthhttp.send(null)}function mygentAuthCallHandler(){4==gentAuthhttp.readyState&&200==gentAuthhttp.status&&(console.log("gent_auth_result="+gentAuthhttp.responseText),"function"==typeof playruncallback&&playruncallback(gentAuthhttp.responseText))}function donwloadhttpcall(e){downloadRequestHttp=createXMLHttpRequest();var t=donwload_command_host+"/downloadRequest?param="+e;downloadRequestHttp.onreadystatechange=downloadRequestCallHandler,downloadRequestHttp.open("GET",t,!0),downloadRequestHttp.send(null)}function downloadRequestCallHandler(){4==downloadRequestHttp.readyState&&200==downloadRequestHttp.status&&(console.log("download result="+downloadRequestHttp.responseText),setTimeout("location.replace('http://cdnplayer.cdnetworks.com:8286/download/downloadstate.html')",2e3))}function proxy_init(e,t,o){function n(){versionCheck(a)}function a(t){1==t?o():(show_loading(!1),e())}function r(e){if(console.log("AgentCheckCallback called------ Streaming"),1==e)console.log("AgentCheckCallback success - Streaming"),versionCheck(a);else{console.log("AgentCheckCallback fail - Streaming");launchProxy("cdnproxy://launch",n,t,t)}}show_loading(!0),checkNRunProxyAgentOnce(r,2e3)}function proxy_downloadinit(e,t,o){function n(){versionCheck(a)}function a(t){1==t?o():(show_loading(!1),console.log("VersionCheckCallback fail- download gogo param="+e),setTimeout(function(){donwloadhttpcall(e)},1e3))}function r(e){if(1==e)versionCheck(a);else{launchProxy("cdnproxy://launch",n,t,t)}}console.log("proxy_download start"),checkNRunProxyAgentOnce(r,2e3),show_loading(!0)}function indicateUpdate(){var e="<div id='area_meg'>";e=e+"<div id='pmsg_2'><div class='logo-aqua'></div></br>Aqua nPlayer의 업데이트가 필요합니다</br>동영상 시청을 위해서, 수동 설치 프로그램을 내려받아 설치해주세요</br><font class='subtxt'><font>&#8727;&nbsp;</font>플레이어 설치가 완료되면 페이지를 새로고침 해주세요</font></br><a href='"+setup_url+"' class='btn-install-default'>지금 설치</a></div>",e+="</div>",$("#video").empty().append(e)}function indicateInstall(){var e="<div id='area_meg'>";e=e+"<div id='pmsg_2'><div class='logo-aqua'></div></br>동영상 시청을 위해서</br>Aqua nPlayer를 설치해주세요</br><font class='subtxt'><font>&#8727;&nbsp;</font>플레이어 설치가 완료되면 페이지를 새로고침 해주세요</font></br><a href='"+setup_url+"' class='btn-install-default'>지금 설치</a></div>",e+="</div>",$("#video").empty().append(e)}function indicateRunFail(){var e="<div id='area_meg' style='display:table; width:100%;height:100%;'><p id='pmsg' style='display:table-cell; color:#fff;text-align:center;vertical-align:middle'>";e+="강의 시청을 위한 플레이어 구동에 실패했습니다<br><font class='subtxt'><font>&#8727;&nbsp;</font>팝업 화면에서 Aqua nPlayer proxy agent 열기를 선택 후, 새로고침 해주세요</font>",e+="</p></div>",$("#video").empty().append(e)}function show_loading(e){if(1==e){var t="<div id='video-loading' style='display:table; width:100%;height:100%;'>";t+="<div style='width:100%;height:100%' class='lds-rolling'><div></div>",t+="</div>",$("#video").prepend(t)}else $("#video-loading").fadeOut(300,function(){$(this).remove()})}var statehttp,videoStartFlag,stopstatehttp,proxyHealthchecked,proxyHealthhttp,proxyverhttp,callerrorhttp,exithttp,newinPlayer,media_auth,mdia_url,gentAuthhttp,proxy_http_host="http://cdnplayer.cdnetworks.com:8282",proxy_https_host="https://cdnplayer.cdnetworks.com:8283",proxy_state_host="http://cdnplayer.cdnetworks.com:8284",donwload_command_host="http://cdnplayer.cdnetworks.com:8288",dupProxycallback,dupPlayercallback,isMac=navigator.platform.toUpperCase().indexOf("MAC")>=0,setup_url,proxy_ver;isMac?(setup_url=NPLAYER_OSX_SETUP_URL,proxy_ver=PROXY_OSX_VERSION):(setup_url=NPLAYER_SETUP_URL,proxy_ver=PROXY_WIN_VERSION);var sysinfohttp,systemresultcallback,AgentCheckCallback,gtimer,gtimeout,eventhandler,checkversioncallback,playruncallback,downloadRequestHttp;