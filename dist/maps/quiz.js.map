{"version":3,"sources":["quiz.js"],"names":["requirejs","btn_check_answer","url","sessionProgressStartLogger","data","training_user_id","course_id","course_list_id","course_list_type","done","res","success","console","error","msg","sessionProgressEndLogger","location","href","next_url","canValidate","isOk","$","hasClass","each","index","this","val","children","length","removeClass","addClass","checkQuizAnswer","quizzes","answers","quiz_type","quiz","quiz_id","quiz_answer","answer","attr","trim","arr","answered","i","push","text","join","ajax","type","btn_play","quiz_inputs","quiz_options","on","e","validateOptionInputs","element","preventDefault","closest","event"],"mappings":"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","file":"../javascripts/quiz.js","sourcesContent":["/**\n * Created by parkseokje\n * 퀴즈, 파이널 테스트\n * TODO\n */\n\n'use strict';\n\nrequirejs([\n  'common'\n],\n  function (Util) {\n    var $ = $ || window.$;\n    var btn_play = $('#btn_play_next');\n    var btn_check_answer = $('#btn_check_answers');\n    var quiz_inputs = $('.answer_quiz_input');\n    var quiz_options = $('.ico:not(.ico_play)');\n    var next_url = btn_play.attr('href');\n    var training_user_id = btn_play.data('training-user-id');\n    var course_id = btn_play.data('course-id');\n    var course_list_id = btn_play.data('course-list-id');\n    var course_list_type = btn_play.data('course-list-type');\n    var canValidate = false;\n\n      // jquery load event\n    $(function () {\n      canValidate = (!btn_check_answer.hasClass('blind')); // 정답확인 가능여부\n      sessionProgressStartLogger();\n    });\n\n    quiz_inputs.on('change keyup', function (e) {\n      // 정답 체크 시마다 모든 문제의 정답 입력/선택 여부를 검사한다.\n      validateOptionInputs();\n    });\n\n    // 정답 체크/미체크, 정답확인 노출여부 판단\n    quiz_options.click(function (e) {\n      e.preventDefault();\n\n      var element = $(this);\n\n      if (element.hasClass('ico_checked')) {\n        element.removeClass('ico_checked');\n        element.addClass('ico_unchecked');\n        element.closest('a').attr('data-value', 0);\n      } else {\n        element.removeClass('ico_unchecked');\n        element.addClass('ico_checked');\n        element.closest('a').attr('data-value', 1);\n      }\n\n        // 정답 체크 시마다 모든 문제의 정답 입력/선택 여부를 검사한다.\n      validateOptionInputs();\n    });\n\n      // 세션 시작일시 로깅\n    function sessionProgressStartLogger () {\n      $.ajax({\n        type: 'POST',\n        url: '/session/log/starttime',\n        data: {\n          training_user_id: training_user_id,\n          course_id: course_id,\n          course_list_id: course_list_id,\n          course_list_type: course_list_type\n        }\n      }).done(function (res) {\n        if (!res.success) {\n          console.error(res.msg);\n        }\n      });\n    }\n\n    // 세션 종료일시 로깅\n    function sessionProgressEndLogger () {\n      $.ajax({\n        type: 'POST',\n        url: '/session/log/endtime',\n        data: {\n          training_user_id: training_user_id,\n          course_id: course_id,\n          course_list_id: course_list_id,\n          course_list_type: course_list_type\n        }\n      }).done(function (res) {\n        if (!res.success) {\n          console.error(res.msg);\n        } else {\n            // console.info('세션 종료시간 기록');\n          location.href = next_url;\n        }\n      });\n    }\n\n    // 정답 입력/선택여부를 체크한다.\n    function validateOptionInputs () {\n      var isOk = true;\n\n      if (canValidate) return isOk;\n\n      $('.option').each(function (index) {\n        if ($(this).hasClass('answer_quiz_input')) {\n          if ($(this).val() === '') {\n            isOk = false;\n            return false;\n          }\n        } else {\n          if ($(this).children().children('a').children('.ico_checked').length === 0) {\n            isOk = false;\n            return false;\n          }\n        }\n      });\n\n      if (isOk) { btn_check_answer.removeClass('blind'); } else { btn_check_answer.addClass('blind'); }\n    }\n\n    btn_check_answer.on('click', function (e) {\n      e.preventDefault();\n      checkQuizAnswer();\n    });\n\n    /**\n     * 정답을 체크한다.\n     * (deprecated)\n     */\n    function checkQuizAnswer_deprecated () {\n      var answers = []; // 전송할 데이터\n\n      $('.option').each(function (index) {\n        if ($(this).hasClass('answer_quiz_input')) {\n          // 단답형\n          answers.push({\n            quiz_id: $(this).data('quiz-id'),\n            answer: $(this).val(),\n            answer_column: 'answer_desc'\n          });\n        } else {\n          // 선택형, 다지선다형\n\n          var answer_ids = [],\n            answer_names = [];\n\n          $(this).children('li').children('a').map(function () {\n            if ($(this).children().hasClass('ico ico_checked')) {\n              answer_ids.push($(this).parent().data('option-id'));\n              answer_names.push($(this).children('.answer').html());\n            }\n          });\n\n          if (answer_ids.length === 0) { answer_ids = ''; }\n\n          answers.push({\n            quiz_id: $(this).data('quiz-id'),\n            answer_ids: answer_ids,\n            answer_names: answer_names.join(','),\n            answer_column: 'answer'\n          });\n        }\n      });\n\n      $.ajax({\n        type: 'POST',\n        url: '/quiz/log/checkanswer',\n        data: {\n          data: answers,\n          training_user_id: training_user_id,\n          course_list_id: course_list_id\n        }\n      }).done(function (res) {\n        if (!res.success) {\n          console.error(res.msg);\n        } else {\n          console.info('퀴즈 정답체크 시작');\n\n          var results = res.results;\n\n          for (var i = 0; i < results.length; i++) {\n            // 오답일 경우 정답표시\n            if (!results[i].iscorrect) {\n              // 정답표시\n              $('#alert_' + results[i].quiz_id).removeClass('blind').html('! 정답은 ' + results[i].correct_answer + ' 입니다.');\n\n              // 단답형일 경우\n              if (results[i].answer_column === 'answer_desc') {\n                $('[name=input_' + results[i].quiz_id + ']').addClass('input_wrong');\n              }\n            } else {\n              $('#alert_' + results[i].quiz_id).removeClass('blind').addClass('correct').html('정답입니다.');\n            }\n          }\n\n          // 다음 버튼 활성화\n          btn_check_answer.addClass('blind');\n          btn_play.removeClass('blind');\n\n          console.info('퀴즈 정답체크 종료');\n        }\n      });\n    }\n\n    /**\n     * 정답을 체크한다.\n     */\n    function checkQuizAnswer () {\n      var quizzes = $('.quiz_select');\n      var answers = [];\n\n      for (var index = 0; index < quizzes.length; index++) {\n        var quiz = $(quizzes[index]);\n        var quiz_type = quiz.data('quiz-type');     // 퀴즈 타입(A/B/C)\n        var quiz_id = quiz.data('quiz-id');         // 퀴즈 id\n        var quiz_answer = quiz.data('quiz-answer');  // 퀴즈 정답\n        var answer = {\n          quiz_id: quiz_id,\n          quiz_type: quiz_type,\n          iscorrect: false,\n          answer: null\n        };\n\n        // 단답형\n        if (quiz_type === 'A') {\n          quiz.attr('data-answered', quiz.children('.not-select').children('.answer_quiz_input').val().trim());\n          quiz.attr('data-iscorrect', (quiz.attr('data-answered') == quiz_answer ? 1 : 0));\n        }\n        // 선택형/다답형\n        else {\n          var arr = quiz.children('ol.selection').children('li');\n          var answered = [];\n\n          quiz.attr('data-iscorrect', 1);\n\n          for (var i = 0; i < arr.length; i++) {\n            if ($(arr[i]).children('a').children('.ico_checked').length > 0) { answered.push($(arr[i]).children('a').children('.answer').text()); }\n\n            var left = $(arr[i]).attr('data-iscorrect'),\n              right = ($(arr[i]).children('a').children('.ico_checked').length > 0);\n\n            if (left != right) { quiz.attr('data-iscorrect', 0); }\n\n            // if ($(arr[i]).attr(\"data-iscorrect\") != 1)\n            //   if ($(arr[i]).children(\"a\").children(\".ico_checked\").length !== 0)\n            //     quiz.attr(\"data-iscorrect\", 0);\n\n            quiz.attr('data-answered', answered.join(','));\n          }\n        }\n\n        quiz.children('.result_quiz').removeClass('correct');\n        if (quiz.attr('data-iscorrect') != 1) {\n          quiz.children('.result_quiz').removeClass('blind')\n            .html('! 정답은 ' + quiz_answer + ' 입니다.');\n        } else {\n          quiz.children('.result_quiz').removeClass('blind')\n            .addClass('correct')\n            .html('정답입니다.');\n        }\n\n        // 사용자 입력답안을 push 한다.\n        answer.iscorrect = quiz.attr('data-iscorrect');\n        answer.answer = quiz.attr('data-answered');\n        answers.push(answer);\n      }\n\n      // 사용자 입력 답안, 정답여부 등을 기록\n      // console.log(answers);\n      $.ajax({\n        type: 'POST',\n        url: '/quiz/log/checkanswer',\n        data: {\n          data: answers,\n          training_user_id: training_user_id,\n          course_id: course_id,\n          course_list_id: course_list_id,\n          course_list_type: course_list_type\n        }\n      })\n      .done(function (res) {\n        if (!res.success) {\n          console.error(res.msg);\n        } else {\n          // 정답체크 완료 시 정답확인: 비활성화, 다음 버튼: 활성화\n          btn_check_answer.addClass('blind');\n          btn_play.removeClass('blind');\n        }\n      });\n    }\n\n    // 다음으로\n    btn_play.on('click', function (event) {\n      event.preventDefault();\n\n      // 세션 종료로그를 기록한다.\n      sessionProgressEndLogger();\n    });\n  }\n);\n"]}